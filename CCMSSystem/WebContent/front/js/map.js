var CiticMap=function(){};CiticMap.prototype={locationwithoutmap:function(c,f,b,e){var d=this;var a=navigator.userAgent.toLowerCase();if(a.indexOf("dkkj")>-1&&window.tower&&window.tower.location&&window.tower.location.getLocation){d.DKKJLocation(c,f,b,e)}else{d.JSlocation(c,f,b,e)}},DKKJLocation:function(e,f,c,h){var g=this;window.dkkjLocationResult=null;var i=function(k){window.dkkjLocationResult={longitude:k.longitude,latitude:k.latitude,accuracy:k.accuracy,city:k.city,status:"success"}};var d=function(k){window.dkkjLocationResult={status:"fail"}};window.tower.location.getLocation({success:i,fail:d});var j=200;var b=50;var a=setInterval(function(){j=j-1;if(j==0){g.JSlocation(e,f,c,h);clearInterval(a)}if(window.dkkjLocationResult){var l=window.dkkjLocationResult;if(l.status==="success"&&l.city){var k=new BMap.Point(l.longitude,l.latitude);g.locationSuccessCallback(0,k,l.accuracy,e,f,c,h)}else{g.JSlocation(e,f,c,h)}clearInterval(a)}},b)},JSlocation:function(d,g,c,f){var e=this;var a=new BMap.Geolocation();a.getCurrentPosition(function b(i){var h=this.getStatus();if(h==BMAP_STATUS_SUCCESS){e.locationSuccessCallback(h,i.point,i.accuracy,d,g,c,f)}else{f(e.datacombinafailed(h))}},{enableHighAccuracy:true,maximumAge:0})},locationSuccessCallback:function(d,h,b,e,f,c,i){var g=this;var a=new BMap.Geocoder();a.getLocation(h,function(j){if(j){var k=j.addressComponents;i(g.datacombinasuccess(d,h.lng,h.lat,k.province,k.city,k.district,k.street,k.streetNumber,b));g.datasubmit(e,f,c,h.lng,h.lat,k.province,k.city,k.district,k.street,k.streetNumber)}else{i(g.datacombinafailed(500))}})},datacombinasuccess:function(g,a,i,c,f,j,b,e,d){var h={status:g,longitude:a,latitude:i,province:c,city:f,district:j,street:b,streetNumber:e,accuracy:d};return h},datacombinafailed:function(a){var b={status:a,longitude:null,latitude:null,province:null,city:null,district:null,street:null,streetNumber:null,accuracy:null};return b},datasubmit:function(i,j,e,a,l,d,g,m,c,f){var b="//creditcard.ecitic.com/citiccard/map/location/v1/save";var h={uiid:i,createTime:Date.parse(new Date()),imeiCode:j,sourceID:e,longitude:a,latitude:l,province:d,city:g,district:m,street:c,streetNumber:f};var k=new XMLHttpRequest();k.open("POST",b,true);k.setRequestHeader("Content-Type","application/json");k.send(JSON.stringify(h))},routePlanningMap:function(k,e,g,l,f,c,s,r){if(!this.baiduMap){var u=new BMap.Map(k);u.centerAndZoom(new BMap.Point(f,l),11);u.enableScrollWheelZoom();u.addControl(new BMap.NavigationControl());this.baiduMap=u}else{this.baiduMap.clearOverlays()}var u=this.baiduMap;var b=new BMap.Point(f,l);var a=new BMap.Point(s,c);var d=new BMap.Icon("//creditcard.ecitic.com/citiccard/map/location/images/startPoint.png",new BMap.Size(32,32));d.setImageSize(new BMap.Size(32,32));var t=new BMap.Marker(b,{icon:d,offset:new BMap.Size(0,-16)});var p=new BMap.Icon("//creditcard.ecitic.com/citiccard/map/location/images/endPoint.png",new BMap.Size(32,32));p.setImageSize(new BMap.Size(32,32));var h=new BMap.Marker(a,{icon:p,offset:new BMap.Size(0,-16)});var o=this;var i={strokeColor:"#009fff",strokeWeight:5,strokeOpacity:1,strokeStyle:"solid"};var j={strokeColor:"#009fff",strokeWeight:4,strokeOpacity:1,strokeStyle:"dashed"};switch(r){case"driving":var q=new BMap.DrivingRoute(u,{renderOptions:{map:u,autoViewport:true}});q.search(b,a);q.setMarkersSetCallback(function(y){var w=o.routecommon(e,g,l,f,c,s,r,y);u.removeOverlay(y[0].marker);u.removeOverlay(y[1].marker);var x=new BMap.InfoWindow(w.content1,w.opts1);h.openInfoWindow(x);h.addEventListener("click",function(){h.openInfoWindow(x)});q.setPolylinesSetCallback(function(A){u.clearOverlays();u.addOverlay(t);u.addOverlay(h);var B=q.getResults().getPlan(0).getRoute(0).getPath();var z=new BMap.Polyline(B,i);u.addOverlay(z);h.openInfoWindow(x)})});break;case"transit":var n=new BMap.TransitRoute(u,{renderOptions:{map:u,autoViewport:true}});n.search(b,a);var v=new BMap.Icon("//creditcard.ecitic.com/citiccard/map/location/images/transit_site.png",new BMap.Size(20,20));v.setImageSize(new BMap.Size(20,20));n.setSearchCompleteCallback(function(w){if(n.getResults().getPlan(0)){n.setMarkersSetCallback(function(z){var x=o.routecommon(e,g,l,f,c,s,r,z);u.removeOverlay(z[0].marker);u.removeOverlay(z[1].marker);var y=new BMap.InfoWindow(x.content1,x.opts1);h.openInfoWindow(y);h.addEventListener("click",function(){h.openInfoWindow(y)})});n.setPolylinesSetCallback(function(y){u.clearOverlays();u.addOverlay(t);u.addOverlay(h);var E=n.getResults().getPlan(0);for(var B=0;B<E.getNumLines();B++){var x=E.getLine(B);var C=x.getGetOnStop().point;var A=x.getGetOffStop().point;var D=new BMap.Marker(C,{icon:v,offset:new BMap.Size(0,-5)});u.addOverlay(D);var z=new BMap.Marker(A,{icon:v,offset:new BMap.Size(0,-5)});u.addOverlay(z);u.addOverlay(new BMap.Polyline(x.getPath(),i))}for(var B=0;B<E.getNumRoutes();B++){var x=E.getRoute(B);u.addOverlay(new BMap.Polyline(x.getPath(),j))}})}else{o.routePlanningMap(k,e,g,l,f,c,s,"walking")}});break;case"walking":var m=new BMap.WalkingRoute(u,{renderOptions:{map:u,autoViewport:true}});m.search(b,a);m.setMarkersSetCallback(function(y){var w=o.routecommon(e,g,l,f,c,s,r,y);u.removeOverlay(y[0].marker);u.removeOverlay(y[1].marker);var x=new BMap.InfoWindow(w.content1,w.opts1);h.openInfoWindow(x);h.addEventListener("click",function(){h.openInfoWindow(x)});m.setPolylinesSetCallback(function(A){u.clearOverlays();u.addOverlay(t);u.addOverlay(h);var C=m.getResults().getPlan(0);var B=m.getResults().getPlan(0).getRoute(0).getPath();var z=new BMap.Polyline(B,i);u.addOverlay(z);h.openInfoWindow(x)})});break;default:o.routePlanningMap(k,e,g,l,f,c,s,"driving");break}},routecommon:function(d,j,e,f,i,k,l,h){var c="<div class='mapinfo'> <div class='infoname'>"+d+"</div>";c+="<div class='infoaddr'>"+j+"</div></div>";c+="<div class='infoaicon'><a href = '//api.map.baidu.com/direction?origin=latlng:"+e+","+f+"|name:我的位置&destination=latlng:"+i+","+k+"|name:"+d+"&mode="+l+"&region="+h[1].city+"&output=html&src=citiccard|mapservice'><img src='//creditcard.ecitic.com/citiccard/map/location/images/route.png'  height='40' width='40' /></a></div> ";var a=c;var b={width:250,offset:new BMap.Size(0,-16)};var g={content1:a,opts1:b};return g},getdistance:function(b,g,a,c){var e=new BMap.Map("mapdiv_default");var f=new BMap.Point(b,g);var d=new BMap.Point(a,c);var h=e.getDistance(f,d);return h},getRouteDuration:function(f,g,j,l,o,n){if(!document.getElementById("routeDurationComputeDiv")){var h=document.getElementsByTagName("body")[0];var c=document.createElement("div");c.setAttribute("id","routeDurationComputeDiv");h.appendChild(c);c.style.display="none"}var m=new BMap.Point(g,f);var k=new BMap.Point(l,j);var b=new BMap.Map("routeDurationComputeDiv");b.centerAndZoom(m,11);switch(o){case"driving":var e=new BMap.DrivingRoute(b,{renderOptions:{map:b,autoViewport:true}});e.search(m,k);e.setSearchCompleteCallback(function(p){var q=e.getResults().getPlan(0).getDuration(true);n(q)});break;case"walking":var a=new BMap.WalkingRoute(b,{renderOptions:{map:b,autoViewport:true}});a.search(m,k);a.setSearchCompleteCallback(function(p){var q=a.getResults().getPlan(0).getDuration(true);n(q)});break;case"transit":var d=new BMap.TransitRoute(b,{renderOptions:{map:b,autoViewport:true}});d.search(m,k);var i=this;d.setSearchCompleteCallback(function(p){if(d.getResults().getPlan(0)){var q=d.getResults().getPlan(0).getDuration(true);n(q)}else{i.getRouteDuration(f,g,j,l,"walking",n)}});break}},baiduMap:null,markers:[],markerMapInit:function(c,a,b){var d=new BMap.Map(c);d.centerAndZoom(new BMap.Point(a.lng,a.lat),14);d.enableScrollWheelZoom();d.addControl(new BMap.NavigationControl());d.addEventListener("dragend",b);d.addEventListener("zoomend",b);this.baiduMap=d},markerMapInitByCity:function(c,b,a){var d=new BMap.Map(c);d.centerAndZoom(b);d.enableScrollWheelZoom();d.addControl(new BMap.NavigationControl());d.addEventListener("dragend",a);d.addEventListener("zoomend",a);this.baiduMap=d},markCurLocation:function(e){var d=this.baiduMap;var a=new BMap.Point(e.lng,e.lat);var c=new BMap.Icon("//creditcard.ecitic.com/citiccard/map/location/images/current-location.png",new BMap.Size(23,23));var b=new BMap.Marker(a,{icon:c});d.addOverlay(b)},panToLocation:function(a){this.baiduMap.panTo(new BMap.Point(a.lng,a.lat))},markPoints:function(b,k,h,f){var a=this.baiduMap;var g;for(var e=0;e<this.markers.length;e++){a.removeOverlay(this.markers[e])}for(var e=0;e<b.length;e++){var j=new BMap.Point(b[e].lng,b[e].lat);var c=b[e].image;var l=new BMap.Icon(c,new BMap.Size(k[0],k[1]));l.setImageSize(new BMap.Size(k[0],k[1]));var d=new BMap.Marker(j,{icon:l,offset:new BMap.Size(0,0-k[1]/2)});d.markerPoint=b[e];a.addOverlay(d);this.markers.push(d);d.addEventListener("click",function(o){var i=o.target;f(i.markerPoint);if(g){var n=new BMap.Icon(g.markerPoint.image,new BMap.Size(k[0],k[1]));n.setImageSize(new BMap.Size(k[0],k[1]));g.setIcon(n)}var m=new BMap.Icon(i.markerPoint.image,new BMap.Size(h[0],h[1]));m.setImageSize(new BMap.Size(h[0],h[1]));i.setIcon(m);g=i})}},getCenter:function(){return this.baiduMap.getCenter()},getPointByInfo:function(b,d,c){var a=new BMap.Geocoder();if(c){a.getPoint(b,function(e){d(e)},c)}else{a.getPoint(b,function(e){d(e)})}},getInfoByPoint:function(a,d){var b=new BMap.Geocoder();var c=new BMap.Point(a.lng,a.lat);b.getLocation(c,function(e){d(e)})}};